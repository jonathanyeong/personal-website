---
import { getCollection } from 'astro:content';
import { Icon } from "astro-icon/components";

import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '@components/Hero.astro';
import FeaturedArticleList from '@components/FeaturedArticleList.astro'
import Newsletter from '@components/Newsletter.astro';

import filterPublishedPosts from '../utilities/filterPublishedPosts';

const posts = filterPublishedPosts(await getCollection('blog'));
const topics = [...new Set(posts.flatMap((post) => post.data.topics))];
const featuredPosts = posts.slice(0, 7)
---

<BaseLayout>
  <main class="flow">
    <Hero />
    <div class="article-list wrapper sidebar">
      <div class="article-list__topics">
        <h2>Topics</h2>
        <ul class="topic-list" role="list">
          {
            topics.map((topic) => (
              <li class="topic-list__item">
                <a href={`/topics/${topic}/`}>{topic}</a>
              </li>
            ))
          }
        </ul>
      </div>
      <div class="article-list__featured">
        <h2>Featured</h2>
        <FeaturedArticleList posts={featuredPosts} />
        <a class="article-list__view-more" href="/writing">view all writing <Icon name="arrow-right" /></a>
      </div>
    </div>
    <Newsletter />
  </main>

</BaseLayout>

<style>
  .article-list {
    --gutter: var(--space-m);
    margin-top: var(--space-3xl);
    flex-direction: column-reverse;

    @media screen and (min-width: 760px) {
      flex-direction: row;
    }
  }

  h2 {
    font-size: var(--font-step-3);
    text-transform: uppercase;
    font-weight: 900;
    letter-spacing: -0.03em;
    display: flex;
    flex-direction: column;
    margin-top: 0;
    margin-bottom: var(--space-l);
  }

  a {
    font-size: var(--font-step-0);
    font-weight: 800;
    text-decoration: none;
    color: var(--color-text);
  }

  a:hover {
    color: var(--color-hover-text);
  }

  .article-list__view-more {
    display: flex;
    justify-content: flex-end;
    flex-direction: row;
    align-items: center;
    text-transform: uppercase;
    gap: var(--space-xs);
    letter-spacing: -0.03em;
    margin-top: var(--space-m);
  }

  [data-icon] {
    font-size: var(--font-step-1);
  }

  .topic-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2xs);
  }

  .topic-list__item a {
    border-radius: var(--space-3xs);
    border: 2px solid var(--color-text);
    display: inline-block;
    padding: var(--space-3xs) var(--space-xs);
    text-transform: capitalize;
  }

  .topic-list__item a:hover {
    border-color: var(--color-hover-text);
  }
</style>
