---
import BaseLayout from "@layouts/BaseLayout.astro";
import FormattedDate from "@components/FormattedDate.astro";
import Newsletter from "@components/Newsletter.astro";
import getTopicsWithPosts from "@utilities/getTopics";

export async function getStaticPaths() {
  const topicsWithPosts = await getTopicsWithPosts();
  return topicsWithPosts.map((t) => ({
    params: { topic: t.topic },
  }));
}

const { topic } = Astro.params;

const topicsWithPosts = await getTopicsWithPosts();

const postsInTopic =
  topicsWithPosts.find((t) => t.topic === topic)?.posts ?? [];
---

<BaseLayout>
  <main class="wrapper">
    <h1>#{topic.toLowerCase()}</h1>
    <ul class="article-list flow">
      {
        postsInTopic.map((post) => (
          <li class="article-list__item">
            <a href={`/writing/${post.id}/`}>{post.data.title}</a>
            <FormattedDate date={post.data.pubDate} />
          </li>
        ))
      }
    </ul>
  </main>
  <Newsletter />
</BaseLayout>

<style>
  main {
    --gutter: var(--space-m);
    margin-top: var(--space-xl);
    margin-bottom: var(--space-3xl);
  }

  h1 {
    font-size: var(--font-step-7);
    font-family: var(--font-hero);
    margin-bottom: var(--space-xl);
  }

  .article-list {
    --flow-space: var(--space-l);
    list-style: none;
    padding: 0;
  }

  .article-list__item {
    display: flex;
    gap: var(--space-xs);
    font-size: var(--font-step-1);
  }
</style>
