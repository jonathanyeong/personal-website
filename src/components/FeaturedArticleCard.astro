---
import type { CollectionEntry } from 'astro:content';
import { Icon } from 'astro-icon/components';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

const getTruncatedDescription = (post: CollectionEntry<'blog'>, maxLength: number = 200): string => {
  // Use description if available, otherwise use body text
  const textToTruncate = post.data.description || post.body;

  // If text is shorter than max length, return as is
  if (!textToTruncate || textToTruncate.length <= maxLength) {
    return textToTruncate || '';
  }

  // Truncate and add ellipsis
  return `${textToTruncate.substring(0, maxLength)}...`;
};

const truncatedDescription = getTruncatedDescription(post);
---
<div class="article-card flow">
  <span class="article-card__title">
    <a href={`/writing/${post.slug}/`}>{post.data.title}</a>
    <span class="article-card__topics">{post.data.topics.join(', ')}</span>
  </span>
  <p>
    {truncatedDescription}
  </p>
  <a href={`/writing/${post.slug}/`} class="article-card__read-more">Read More <Icon name="arrow-right" /></a>
</div>

<style>
  .article-card {
    --flow-space: var(--space-s);

    font-size: var(--font-step-0);
    padding-bottom: var(--space-m);
    border-bottom: 1px solid var(--color-gray-0);
  }

  .article-card__title,
  .article-card__read-more {
    display: block;
  }

  .article-card__title {
    display: flex;
    flex-direction: row;
    gap: var(--space-m);
    align-items: center;
  }

  a {
    color: var(--color-text);
    font-weight: bold;
    font-size: var(--font-step-1);
    text-decoration: none;
    letter-spacing: -0.03em;
    white-space: nowrap;
  }

  a:hover {
    color: var(--color-hover-text);
  }

  .article-card__read-more {
    display: flex;
    font-size: var(--font-step-0);
    text-transform: uppercase;
    align-items: center;
    gap: var(--space-2xs);
    letter-spacing: 0;
  }

  [data-icon="arrow-right"] {
    transform: translateY(0.05cap);
    width: 1.5rem;
    height: 1.5rem
  }

  .article-card__topics {
    font-style: italic;
  }
</style>